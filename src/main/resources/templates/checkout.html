<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Complete your purchase at Wearify - Premium fashion checkout">
    <title>Checkout - Wearify</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ùïé</text></svg>">
    <link rel="stylesheet" href="/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="container nav-container">
            <div class="logo">
                <a href="/" style="display: flex; align-items: center; text-decoration: none;">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="url(#gradient)" stroke-width="2"
                        style="margin-right: 8px;">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <path
                            d="M9 2L7.17 6M15 2l1.83 4M3.34 6h17.32a1 1 0 01.98 1.2l-1.83 10a2 2 0 01-1.97 1.8H6.16a2 2 0 01-1.97-1.8l-1.83-10A1 1 0 013.34 6z" />
                    </svg>
                    <h1>Wearify</h1>
                </a>
            </div>
        </div>
    </nav>

    <!-- Checkout Hero -->
    <section class="hero" style="min-height: 40vh; padding-top: 150px;">
        <div class="hero-background"></div>
        <div class="container" style="text-align: center;">
            <div class="hero-content" style="max-width: 100%;">
                <span class="hero-label">Secure Checkout</span>
                <h2 class="hero-title">Complete Your Order</h2>
                <p class="hero-description" style="margin: 0 auto; max-width: 700px;">Review your items and proceed to
                    payment</p>
            </div>
        </div>
    </section>

    <!-- Checkout Content -->
    <section class="products" style="padding: 3rem 0 5rem;">
        <div class="container">
            <div style="display: grid; grid-template-columns: 1fr 400px; gap: 3rem; align-items: start;">

                <!-- Cart Items & Address -->
                <div>
                    <h3 style="font-size: 1.75rem; margin-bottom: 2rem; font-family: var(--font-heading);">Your Items
                    </h3>
                    <div id="checkoutItems"
                        style="background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <div th:each="item : ${cartItems}"
                            style="display: flex; gap: 1.5rem; padding: 1.5rem 0; border-bottom: 1px solid #e5e7eb; align-items: center;">
                            <img th:src="@{/images/{id}(id=${item.product.id})}" alt="Product"
                                style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                            <div style="flex: 1;">
                                <h4 style="font-size: 1.125rem; margin-bottom: 0.5rem; color: var(--neutral-900);"
                                    th:text="${item.product.name}">Product Name</h4>
                                <p style="color: var(--neutral-600); font-size: 0.875rem; margin-bottom: 0.5rem;">Qty:
                                    <span th:text="${item.quantity}">1</span>
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <p style="font-size: 1.25rem; font-weight: 700; color: var(--neutral-900);">‚Çπ<span
                                        th:text="${item.product.discountedPrice * item.quantity}">0</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Delivery Address -->
                    <h3 style="font-size: 1.75rem; margin-bottom: 2rem; font-family: var(--font-heading);">Delivery
                        Address</h3>

                    <!-- Existing Addresses -->
                    <div th:if="${!addresses.isEmpty()}"
                        style="background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <form th:action="@{/order/place}" method="post" id="orderForm">
                            <div th:each="address : ${addresses}" style="margin-bottom: 1rem;">
                                <label
                                    style="display: flex; gap: 1rem; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer;">
                                    <input type="radio" name="addressId" th:value="${address.id}" required>
                                    <div>
                                        <p style="font-weight: 600; margin-bottom: 0.25rem;" th:text="${address.name}">
                                            Name</p>
                                        <p style="color: var(--neutral-600); font-size: 0.875rem;"
                                            th:text="${address.area + ', ' + address.city + ', ' + address.state + ' - ' + address.pincode}">
                                            Address</p>
                                    </div>
                                </label>
                            </div>
                        </form>
                    </div>

                    <!-- Add New Address Form -->
                    <div
                        style="background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1.5rem;">Add New Address</h4>
                        <form th:action="@{/address/add}" method="post">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Full
                                        Name</label>
                                    <input type="text" name="name" required
                                        style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                                </div>
                                <div>
                                    <label
                                        style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Pincode</label>
                                    <input type="number" name="pincode" required
                                        style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                                </div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Area /
                                    Street</label>
                                <input type="text" name="area" required
                                    style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">City</label>
                                    <input type="text" name="city" required
                                        style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                                </div>
                                <div>
                                    <label
                                        style="display: block; margin-bottom: 0.5rem; font-weight: 600;">State</label>
                                    <select name="state" required
                                        style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                                        <option value="DL">Delhi</option>
                                        <option value="MH">Maharashtra</option>
                                        <option value="KA">Karnataka</option>
                                        <option value="TN">Tamil Nadu</option>
                                        <option value="UP">Uttar Pradesh</option>
                                        <option value="WB">West Bengal</option>
                                        <!-- Add more states as needed -->
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-secondary btn-block">Save Address</button>
                        </form>
                    </div>

                    <!-- Payment Method -->
                    <h3 style="font-size: 1.75rem; margin-bottom: 2rem; font-family: var(--font-heading);">Payment
                        Method</h3>
                    <div
                        style="background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <!-- Using the same form ID 'orderForm' to submit address and payment together -->
                        <!-- We need to move the form tag to wrap both Address Selection and Payment Selection if they are separate,
                              but here Addresses are in one div and this is another. 
                              The 'orderForm' is currently ONLY around the address list. 
                              We need to fix the form structure. 
                              
                              Wait, the previous code had <form id="orderForm"> around the address list items.
                              If I want to submit both, I should probably use `form="orderForm"` attribute on inputs if outside, 
                              OR better, put the payment options INSIDE the existing form, or extend the form.
                              
                              Let's check the existing structure again. 
                              Lines 91-105 contained the form.
                              Line 109 starts "Add New Address".
                              
                              I will inject the Payment Method section into the DOM, but I need to make sure it's part of the form submission.
                              The easiest way is to use the `form="orderForm"` attribute on the inputs if HTML5 is supported (it is),
                              OR strictly speaking, I should have wrapped everything in one big form.
                              
                              However, `address/add` is a separate form.
                              
                              Let's use the `form="orderForm"` attribute for the payment radio buttons to keep it simple without restructuring the entire page's HTML nesting too much.
                          -->

                        <div style="display: grid; gap: 1rem;">
                            <!-- COD -->
                            <label
                                style="display: flex; gap: 1rem; padding: 1.5rem; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer; align-items: center; transition: all 0.2s;">
                                <input type="radio" name="paymentMethod" value="COD" form="orderForm" checked required
                                    style="width: 20px; height: 20px; accent-color: var(--primary-600);">
                                <div style="flex: 1;">
                                    <div
                                        style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                        <span style="font-size: 1.5rem;">üíµ</span>
                                        <span style="font-weight: 700; font-size: 1.1rem;">Cash on Delivery</span>
                                    </div>
                                    <p style="color: var(--neutral-600); font-size: 0.9rem;">Pay when you receive your
                                        order</p>
                                </div>
                            </label>

                            <!-- Card -->
                            <label
                                style="display: flex; gap: 1rem; padding: 1.5rem; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer; align-items: center; transition: all 0.2s;">
                                <input type="radio" name="paymentMethod" value="Card" form="orderForm"
                                    style="width: 20px; height: 20px; accent-color: var(--primary-600);">
                                <div style="flex: 1;">
                                    <div
                                        style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                        <span style="font-size: 1.5rem;">üí≥</span>
                                        <span style="font-weight: 700; font-size: 1.1rem;">Credit / Debit Card</span>
                                    </div>
                                    <p style="color: var(--neutral-600); font-size: 0.9rem;">Secure payment via
                                        Stripe/Razorpay</p>
                                </div>
                            </label>

                            <!-- UPI -->
                            <label
                                style="display: flex; gap: 1rem; padding: 1.5rem; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer; align-items: center; transition: all 0.2s;">
                                <input type="radio" name="paymentMethod" value="UPI" form="orderForm"
                                    style="width: 20px; height: 20px; accent-color: var(--primary-600);">
                                <div style="flex: 1;">
                                    <div
                                        style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                        <span style="font-size: 1.5rem;">üì±</span>
                                        <span style="font-weight: 700; font-size: 1.1rem;">UPI / Wallet</span>
                                    </div>
                                    <p style="color: var(--neutral-600); font-size: 0.9rem;">GPay, PhonePe, Paytm</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div style="position: sticky; top: 100px;">
                    <div
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 2rem; color: white; box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);">
                        <h3 style="font-size: 1.5rem; margin-bottom: 1.5rem; font-family: var(--font-heading);">Order
                            Summary</h3>

                        <div
                            style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.2);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                                <span style="opacity: 0.9;">Subtotal</span>
                                <span><span id="checkoutSubtotal" th:text="${subtotal}">0</span></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                                <span style="opacity: 0.9;">Shipping</span>
                                <span>FREE</span>
                            </div>
                        </div>

                        <div
                            style="display: flex; justify-content: space-between; font-size: 1.5rem; font-weight: 700; margin-bottom: 2rem;">
                            <span>Total</span>
                            <span><span id="checkoutTotal" th:text="${total}">0</span></span>
                        </div>

                        <button type="submit" form="orderForm" class="btn btn-secondary btn-block"
                            style="background: white; color: var(--primary-600); font-weight: 700; font-size: 1.125rem;">
                            Place Order
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script th:inline="javascript">
        /*<![CDATA[*/
        window.serverProducts = /*[[${products}]]*/[];
        /*]]>*/
    </script>
    <script src="/script.js"></script>
    <script>
        // Client-side checkout logic removed to prevent conflict with server-side rendering
    </script>
</body>

</html>